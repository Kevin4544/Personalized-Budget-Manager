# Lets the program save and load data in a database file
import sqlite3

# Main library for building the program window
import tkinter as tk

# ttk gives better-looking widgets, messagebox shows popup messages
from tkinter import ttk, messagebox

# Used for working with dates
from datetime import datetime, date

# Helps group values without extra checks
from collections import defaultdict

# Used for making charts
import matplotlib

# Connects matplotlib charts to Tkinter
matplotlib.use("TkAgg")

# Creates the chart area
from matplotlib.figure import Figure

# Displays the chart inside the Tkinter window
from matplotlib.backends.backend_tkagg import FigureCanvasTkAgg


# Name of the database file
DB_FILE = "budget.db"

# Standard date format: year-month-day
DATE_FMT = "%Y-%m-%d"

# Default expense categories for the budget
DEFAULT_CATEGORIES = [
    "Rent", "Utilities", "Groceries", "Transport", "Dining",
    "Entertainment", "Health", "Subscriptions", "Shopping", "Other"
]
#Both functions validate user input before the app stores it in the database.
def safe_float(raw_text: str) -> float:
    raw_text = (raw_text or "").strip()
    if not raw_text:
        raise ValueError("Amount is required.")
    amount_value = float(raw_text)
    if amount_value < 0:
        raise ValueError("Amount must be >= 0.")
    return amount_value


def safe_date(raw_text: str) -> str:
    raw_text = (raw_text or "").strip()
    if not raw_text:
        return date.today().strftime(DATE_FORMAT)
    datetime.strptime(raw_text, DATE_FORMAT)
    return raw_text

class BudgetDB:
    def __init__(self, database_path: str):
        # Connect to the budget database file
        self.conn = sqlite3.connect(database_path)
        # Enable foreign key rules in SQLite
        self.conn.execute("PRAGMA foreign_keys = ON;")
        # Set up the database tables and default values
        self._init_schema()


